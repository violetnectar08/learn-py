(self.webpackChunk_aquirdturtle_collapsible_headings=self.webpackChunk_aquirdturtle_collapsible_headings||[]).push([[568],{568:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>w});var l=n(28),d=n(910),i=n(238),o=n(129);const r={activate:function(e,t,n,l){console.log("JupyterLab extension @aquirdturtle/collapsible_headings is activated!!"),l.load(r.id).then((e=>c(0)));const o="Collapsible_Headings:Toggle_Collapse",p="Collapsible_Headings:Manually_Update_Collapse_Buttons",w="Collapsible_Headings:Manually_Update_Notebook_Collapse_State",x="Collapsible_Headings:Collapse_All",I="Collapsible_Headings:UnCollapse_All",_="Collapsible_Headings:Add_Header_Above",k="Collapsible_Headings:Add_Header_Below",y="Collapsible_Headings:Uncollapse_Header",N="Collapsible_Headings:Collapse_Header",E="Collapsible_Headings:HandleUp",A="Collapsible_Headings:HandleDown";e.commands.addCommand(o,{label:"Toggle Collapse",execute:()=>{h(t)}}),e.commands.addCommand(p,{label:"Refresh Collapse Buttons",execute:()=>{m(t)}}),e.commands.addCommand(w,{label:"Refresh Notebook Collapse State",execute:()=>{u(t)}}),e.commands.addCommand(x,{label:"Collapse All Cells",execute:()=>{!function(e){if(c(),e.currentWidget)for(let t=0;t<e.currentWidget.content.widgets.length;t++){let n=e.currentWidget.content.widgets[t];H(n).isHeader&&(v(e,t,!0),b(n,!0),C(f(n,e),!0,H(n).headerLevel))}u(e)}(t)}}),e.commands.addCommand(I,{label:"Un-Collapse All Cells",execute:()=>{!function(e){if(c(),e.currentWidget)for(let t=0;t<e.currentWidget.content.widgets.length;t++){let n=e.currentWidget.content.widgets[t];H(n).isHeader&&(v(e,t,!1),b(n,!1),C(f(n,e),!1,H(n).headerLevel))}u(e)}(t)}}),e.commands.addCommand(_,{label:"Add Header Above",execute:()=>{!function(e){if(!e.activeCell)return;let t=H(e.activeCell);if(!t.isHeader){let n=g(e.currentWidget.content.activeCellIndex,e);t=H(e.currentWidget.content.widgets[n])}0==t.isHeader&&c(),d.NotebookActions.insertAbove(e.currentWidget.content),d.NotebookActions.setMarkdownHeader(e.currentWidget.content,t.headerLevel),d.NotebookActions.changeCellType(e.currentWidget.content,"markdown"),c(e.activeCell),e.activeCell.editor.setSelection({start:{line:0,column:t.headerLevel+1},end:{line:0,column:10}}),e.activeCell.editor.focus(),c()}(t)}}),e.commands.addCommand(k,{label:"Add Header Below",execute:()=>{!function(e){if(!e.activeCell)return;let t=H(e.activeCell);if(!t.isHeader){let n=g(e.currentWidget.content.activeCellIndex,e);t=H(e.currentWidget.content.widgets[n])}let n=s(e.currentWidget.content.activeCellIndex,e);0==t.isHeader&&c(),e.currentWidget.content.activeCellIndex=n,d.NotebookActions.insertAbove(e.currentWidget.content),d.NotebookActions.setMarkdownHeader(e.currentWidget.content,t.headerLevel),d.NotebookActions.changeCellType(e.currentWidget.content,"markdown"),e.activeCell.editor.setSelection({start:{line:0,column:t.headerLevel+1},end:{line:0,column:10}}),e.activeCell.editor.focus(),c()}(t)}}),e.commands.addCommand(y,{label:"Un-Collapse Header",execute:()=>{!function(e){if(e.activeCell){if(H(e.activeCell).isHeader)v(e,e.currentWidget.content.activeCellIndex,!1);else{let t=s(e.currentWidget.content.activeCellIndex,e);if(-1==t)return;e.currentWidget.content.activeCellIndex=t}i.ElementExt.scrollIntoViewIfNeeded(e.currentWidget.content.node,e.activeCell.node)}}(t)}}),e.commands.addCommand(N,{label:"Collapse Header",execute:()=>{!function(e){if(e.activeCell){if(H(e.activeCell).isHeader)if(W(e.activeCell)){let t=g(e.currentWidget.content.activeCellIndex,e);if(-1==t)return;e.currentWidget.content.activeCellIndex=t}else v(e,e.currentWidget.content.activeCellIndex,!0);else{let t=g(e.currentWidget.content.activeCellIndex,e);if(-1==t)return;e.currentWidget.content.activeCellIndex=t}i.ElementExt.scrollIntoViewIfNeeded(e.currentWidget.content.node,e.activeCell.node)}}(t)}}),e.commands.addCommand(E,{label:"Handle Up Arrow",execute:()=>{!function(e){if(c(),0==e.currentWidget.content.activeCellIndex)return;e.currentWidget.content.deselectAll();let t=e.currentWidget.content.activeCellIndex-1;if(e.currentWidget.content.widgets[t].isHidden){let n=function(e,t){if(e>=t.currentWidget.content.widgets.length)return-1;for(;e>0;)if(e-=1,!t.currentWidget.content.widgets[e].isHidden)return e;return-1}(t,e);if(-1==n)return;c(),e.currentWidget.content.activeCellIndex=n}else c(),e.currentWidget.content.activeCellIndex-=1;i.ElementExt.scrollIntoViewIfNeeded(e.currentWidget.content.node,e.activeCell.node)}(t)}}),e.commands.addCommand(A,{label:"Handle Down Arrow",execute:()=>{!function(e){c(),e.currentWidget.content.deselectAll();let t=e.currentWidget.content.activeCellIndex+1;if(!(t>=e.currentWidget.content.widgets.length)){if(e.currentWidget.content.widgets[t].isHidden){let n=function(e,t){if(e>=t.currentWidget.content.widgets.length||e<0)return-1;for(;e<t.currentWidget.content.widgets.length-1;)if(e+=1,!t.currentWidget.content.widgets[e].isHidden)return e;return-1}(t,e);if(-1==n)return;c(),e.currentWidget.content.activeCellIndex=n}else c(),e.currentWidget.content.activeCellIndex+=1;i.ElementExt.scrollIntoViewIfNeeded(e.currentWidget.content.node,e.activeCell.node)}}(t)}}),n.addItem({command:o,category:"Collapsible Headings Extension"}),n.addItem({command:p,category:"Collapsible Headings Extension"}),n.addItem({command:w,category:"Collapsible Headings Extension"}),n.addItem({command:x,category:"Collapsible Headings Extension"}),n.addItem({command:I,category:"Collapsible Headings Extension"}),n.addItem({command:_,category:"Collapsible Headings Extension"}),n.addItem({command:k,category:"Collapsible Headings Extension"}),n.addItem({command:y,category:"Collapsible Headings Extension"}),n.addItem({command:N,category:"Collapsible Headings Extension"}),n.addItem({command:E,category:"Collapsible Headings Extension"}),n.addItem({command:A,category:"Collapsible Headings Extension"}),t.currentChanged.connect((()=>{t.currentWidget.content.model.stateChanged.connect((()=>{t.currentWidget.content.widgets.length>1&&(m(t),setTimeout((()=>{u(t)}),10))}))})),d.NotebookActions.executed.connect((()=>{c(),m(t)})),setTimeout((()=>{e.commands.addKeyBinding({command:E,args:{},keys:["ArrowUp"],selector:".jp-Notebook:focus"})}),2e3),setTimeout((()=>{e.commands.addKeyBinding({command:E,args:{},keys:["K"],selector:".jp-Notebook:focus"})}),2e3),setTimeout((()=>{e.commands.addKeyBinding({command:A,args:{},keys:["ArrowDown"],selector:".jp-Notebook:focus"})}),2e3),setTimeout((()=>{e.commands.addKeyBinding({command:A,args:{},keys:["J"],selector:".jp-Notebook:focus"})}),2e3),t.activeCellChanged.connect((()=>{!function(e){a(e.currentWidget.content.activeCellIndex,e)}(t)}))},requires:[d.INotebookTracker,l.ICommandPalette,o.ISettingRegistry],id:"@aquirdturtle/collapsible_headings:plugin",autoStart:!0};function c(e,...t){}function a(e,t){let n=g(e,t);if(-1==n)return;let l=t.currentWidget.content.widgets[n];(W(l)||l.isHidden)&&(l.isHidden&&a(n,t),W(l)&&v(t,n,!1))}function s(e,t){if(e>=t.currentWidget.content.widgets.length)return-1;let n=H(t.currentWidget.content.widgets[e]);for(let l=e+1;l<t.currentWidget.content.widgets.length;l++){let e=H(t.currentWidget.content.widgets[l]);if(e.isHeader&&e.headerLevel<=n.headerLevel)return l}return t.currentWidget.content.widgets.length-1}function g(e,t){if(e>=t.currentWidget.content.widgets.length)return-1;let n=H(t.currentWidget.content.widgets[e]);for(let l=e-1;l>=0;l--)if(l<t.currentWidget.content.widgets.length){let e=H(t.currentWidget.content.widgets[l]);if(e.isHeader&&e.headerLevel<n.headerLevel)return l}return-1}function u(e){let t=0,n=0;if(e.currentWidget)for(;t<e.currentWidget.content.widgets.length&&n<1e6;)t=v(e,t,W(e.currentWidget.content.widgets[t])),n+=1}function m(e){let t=e.currentWidget.content.widgets;for(let l=0;l<t.length;l++){let d=t[l];H(d).isHeader?p(d,e):0!=(n=d).promptNode.getElementsByClassName("ch-button").length&&n.promptNode.removeChild(n.promptNode.getElementsByClassName("ch-button")[0])}var n}function C(e,t,n){e.style.background=t?"var(--jp-icon-caret-right) no-repeat center":"var(--jp-icon-caret-down) no-repeat center",e.style.position="relative",e.style.backgroundSize="30px 30px";let l=4*n-15;e.style.bottom=l.toString()+"px"}function f(e,t){if(0==e.promptNode.getElementsByClassName("ch-button").length){let n=e.promptNode.appendChild(document.createElement("button"));return n.className="bp3-button bp3-minimal jp-Button minimal ch-button",n.onclick=()=>{h(t)},n}return e.promptNode.getElementsByClassName("ch-button")[0]}function p(e,t){C(f(e,t),W(e),H(e).headerLevel)}function v(e,t,n){if(!e)return t+1;e.currentWidget.content.widgets.length;let l=e.currentWidget.content.widgets[t];if(!l)return t+1;let d=H(l),i=!1;if(null==l)return;for(let e=0;e<l.node.classList.length;e++)"jp-MarkdownCell"==l.node.classList[e]&&(i=!0);if(l.isHidden||!i||!d.isHeader)return t+1;b(l,n),C(f(l,e),n,H(l).headerLevel);let o=!1,r=0,c=t+1;for(c=t+1;c<e.currentWidget.content.widgets.length;c++){let t=e.currentWidget.content.widgets[c],l=H(t);if(l.isHeader&&l.headerLevel<=d.headerLevel){c-=1;break}o&&l.isHeader&&l.headerLevel<=r&&(o=!1),n||o?t.setHidden(!0):(W(t)&&l.isHeader&&(o=!0,r=l.headerLevel),t.setHidden(!1))}return c+1}function h(e){if(e.activeCell){if(H(e.activeCell).isHeader){let t=!W(e.activeCell);v(e,e.currentWidget.content.activeCellIndex,t)}else{let t=g(e.currentWidget.content.activeCellIndex,e);if(-1==t)return;v(e,t,!W(e.currentWidget.content.widgets[t])),e.currentWidget.content.activeCellIndex=t}i.ElementExt.scrollIntoViewIfNeeded(e.currentWidget.content.node,e.activeCell.node)}}function W(e){let t=e.model.metadata,n=!1;return t.has("Collapsed")&&(t.set("heading_collapsed",t.get("Collapsed")),t.delete("Collapsed")),t.has("heading_collapsed")&&(n="true"===t.get("heading_collapsed")),n}function b(e,t){let n=e.model.metadata;t?n.set("heading_collapsed","true"):n.delete("heading_collapsed")}function H(e){let t=!1;if(null==e)return;for(let n=0;n<e.node.classList.length;n++)"jp-MarkdownCell"==e.node.classList[n]&&(t=!0);if(!t)return{isHeader:!1,headerLevel:7};const n=e.model.value.text.split("\n"),l=n[0],d=n.length>1?n[1]:void 0;let i=l.match(/^([#]{1,6}) (.*)/),o=d&&d.match(/^([=]{2,}|[-]{2,})/),r=l.match(/<h([1-6])(.*)>(.*)<\/h\1>/i),c=null!==i||null!=o&&!1!==Boolean(o)||null!==r,a=7;return i?a=i[1].length:o?a="="===o[1][0]?1:2:r&&(a=parseInt(r[1],10)),{isHeader:c,headerLevel:a}}const w=r}}]);